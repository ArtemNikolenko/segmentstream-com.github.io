---
layout: page
section: analystRU
title: "Переменные"
date: 2013-06-05 12:00:00
order: 4
---

**Модуль "Переменные"** позволяет на основе данных, находящихся в объекте `digitalData` создавать новые данные. Модуль решает широкий спектр задач: от преобразования одного формата данных к другому или создания новой переменной в `DigitalData` на основе данных, полученных из сторонних систем.

### Навигация по странице
------
<ul class="page-navigation">
  <li><a href="#0">Введение</a></li>
  <li><a href="#1">Создание новой переменной</a></li>
  <li><a href="#3">Типы триггеров</a></li>
  <li><a href="#4">Вспомогательные функции</a></li>
  <li><a href="#5">Тестирование переменных</a></li>
</ul>

### <a name="0"></a>Введение
------
SegmentStream позволяет отправлять данные из объекта `digitalData` в любые маркетинговые системы, например информацию о том, что пользователь уже делал покупки в [Criteo](http://www.criteo.com/). Criteo в качестве сегмента принимает только числовое значение, поэтому вам придется преобразовать информацию о покупках к числовому виду. Можно попросить ваших программистов с каждой загрузкой страницы передавать в переменную `digitalData.user.criteoSegment` значение 1, но проще создать эту переменную в интерфейсе SegmentStream.
Чтобы создать новую переменную нажмите кнопку "Добавить" на экране списка всех переменных. Для редактирования созданных ранее переменных - нажмите на название необходимой переменной.

### <a name="1"></a>Создание новой переменной
------
В момент поступления события `Completed Transaction` вы должны определить переменную `digitalData.user.criteoSegment` со значением `1` и сохранить ее навсегда в Local storage (хранилище в браузере посетителя).

![](/img/variables.1.png)

Далее в настройках интеграции Criteo укажите имя переменной, в которой хранится пользовательский сегмент - `digitalData.user.criteoSegment`.

### <a name="2"></a>Типы триггеров
------
В инструменте создания переменных существует 2 настройки:
1. Первая позволяет выбрать момент сохранения переменной:до или после события.
2. Имя этого события указывается во втором поле.

Если вы выберите настройку "перед событием" в первой настройке, вы сможете отправить значение из созданной переменной вместе с событием, указанным во втором поле.
Если вы выберете "после события", переменная будет создана после события, и информация не будет отправлена ​​вместе с событием.

### <a name="3"></a>Сохранение переменной
------
В зависимости от настроек, переменные будут создаваться каждый раз заново при срабатывании заданного триггера либо будут извлекаться из локального хранилища на устройстве пользователя (Local Storage).
Срок хранения (в секундах) переменной можно указать в настройках.

> Совет. Бывает так, что сохранять переменную нужно не на определенное время, а до наступления определенного события. В этом случае необходимо создать 2 переменные

**Пример**: Необходимо передать в google analytics количество просмотров карточек товаров перед покупкой.

Для решения данной задачи вам нужно увеличивать на 1 значение счетчика при срабатывании события [`Viewed Product Detail`](/ru/events/viewed-product-detail) и сохранять значение в переменной `digitalData.custom.viewedProductsCount`.Вместе с событием [`Completed Transaction`](/ru/events/completed-transaction) - отправлять значение переменной в качестве [пользовательской метрики](/ru/integrations/google-analytics#11). После наступлении события `Completed Transaction` - обнулять счетчик и сохранять в переменной `digitalData.custom.viewedProductsCount`.
1. `digitalData.custom.viewedProductsCount` - сохранение значения счетчика.

  ![](/img/variables.2.png)

  **Функция, которая заполняет значение переменной**

  ```javascript
  var viewedProductsCount = _digitalData('custom.viewedProductsCount') || 0;
  return (viewedProductsCount + 1);
  ```
2. `digitalData.custom.viewedProductsCount` - сохранение значения счетчика.

![](/img/variables.2.png)

**Функция, которая заполняет значение переменной**

```javascript
return 0;
```

### <a name="4"></a>Вспомогательные функции
------
При создании переменных полезно использовать набор встроенных функций, которые значительно упрощают и сокращают код исполнительных функций. Перечень вспомогательных функций описан [разделе события](/ru/for-analyst/events#3).

### <a name="5"></a>Тестирование переменных
------
Логика тестирования переменных идентична логике тестирования событий и интеграций:
1. Новая переменная всегда создается в "активном состоянии". Это значит, что если вы нажмете кнопку "Опубликовать", ваша переменная будет работать (или не работать, если она была неправильно настроена). Вы можете заранее проверить правильность заполнения переменной, перейдя на ваш сайт в режиме test_mode. После загрузки страницы откройте консоль (клик правой кнопкой мыши), наберите digitalData.

![](/img/variables.4.png)

> Чтобы активировать test_mode необходимо загрузить любую страницу вашего сайте с GET-параметром ddm_test_mode=1, например: [http://shop1.driveback.ru/?ddm_test_mode=1](http://shop1.driveback.ru/?ddm_test_mode=1)

2. Если вы хотите отключить переменную, нажмите на кнопку в правом верхнем углу настройки переменной и переведите в состояние "Отключена".

![](/img/variables.5.png)

3. Переменная всегда может быть удалена по нажатию на кнопку "удалить" в самой нижней части панели настроек переменной.
