<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>SegmentStream documentation : Helper functions</title>
        <meta name="description" content="">

        <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicon/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicon/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicon/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicon/apple-touch-icon-60x60.png" />
        <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicon/apple-touch-icon-120x120.png" />
        <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicon/apple-touch-icon-76x76.png" />
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicon/apple-touch-icon-152x152.png" />
        <link rel="icon" type="image/png" href="/favicon/favicon-196x196.png" sizes="196x196" />
        <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16" />
        <link rel="icon" type="image/png" href="/favicon/favicon-128.png" sizes="128x128" />
        <meta name="application-name" content="&nbsp;"/>
        <meta name="msapplication-TileColor" content="#FFFFFF" />
        <meta name="msapplication-TileImage" content="/favicon/mstile-144x144.png" />
        <meta name="msapplication-square70x70logo" content="/favicon/mstile-70x70.png" />
        <meta name="msapplication-square150x150logo" content="/favicon/mstile-150x150.png" />
        <meta name="msapplication-wide310x150logo" content="/favicon/mstile-310x150.png" />
        <meta name="msapplication-square310x310logo" content="/favicon/mstile-310x310.png" />

        <!-- <link rel="shortcut icon" type="image/x-icon" href="/favicon/favicon.ico"> -->
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/syntax.css">
        <link rel="stylesheet" href="/css/main.css?v=1.1">
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="/js/main.js?v=1.1"></script>
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <div class="row">
    <div class="col-sm-3 col-xs-12">
        <div id="menu-toggle"></div>
        <a target="_blank" href="https://admin.segmentstream.com/"><div id="login-button"></div></a>
        <a class="brand" href="/"><img src="/img/segmentstream-logo.png" height="47" alt=SegmentStream documentation
                class="ddm-logo">
        </a>
        <small></small>
    </div>

    <div class="col-sm-offset-5 col-sm-4 authorization">
        <ul class="top-nav">
            <li>
                <a id="button-auth" target="_blank" href="https://admin.segmentstream.com/">
                    
                    Login
                    
                </a>
            </li>
        </ul>
    </div>
        
            <a id="language-button" href='/ru/'>RU</a>
        
</div>


                </div>
            </div>
            <div class="row">
                
                
                    <div id="navigation" class="col-sm-3 col-md-3">
                        <ul class="nav nav-list" >
    
    
        
        
        
        
        
        
        
        
            <li class="nav-header analyst ">Analyst</li>
            
                <li class="drop-menu analyst " data-order="0">
                    <a href="/for-analyst/index">Overview</a>
                </li>
            
                <li class="drop-menu analyst " data-order="0">
                    <a href="/for-analyst/manual-imports">CSV file upload</a>
                </li>
            
                <li class="drop-menu analyst " data-order="1">
                    <a href="/for-analyst/settings">Project settings</a>
                </li>
            
                <li class="drop-menu analyst " data-order="2">
                    <a href="/for-analyst/events">Events</a>
                </li>
            
                <li class="drop-menu analyst " data-order="2">
                    <a href="/for-analyst/integrations">Integrations</a>
                </li>
            
                <li class="drop-menu analyst " data-order="4">
                    <a href="/for-analyst/variables">Variables</a>
                </li>
            
                <li class="drop-menu analyst " data-order="5">
                    <a href="/for-analyst/scripts">Scripts</a>
                </li>
            
                <li class="drop-menu analyst " data-order="6">
                    <a href="/for-analyst/priorities">Priorities</a>
                </li>
            
        
        
    
        
        
        
        
        
        
        
        
            <li class="nav-header developer  active ">Developer</li>
            
                <li class="drop-menu developer active  " data-order="1">
                    <a href="/for-developer/index">Overview</a>
                </li>
            
                <li class="drop-menu developer active  " data-order="2">
                    <a href="/for-developer/digitaldata">digitalData object</a>
                </li>
            
                <li class="drop-menu developer active  " data-order="2">
                    <a href="/for-developer/partners">Third-party system events</a>
                </li>
            
                <li class="drop-menu developer active  " data-order="3">
                    <a href="/for-developer/naming">Event and variable naming conventions</a>
                </li>
            
                <li class="drop-menu developer active  " data-order="3">
                    <a href="/for-developer/snippet">Connecting SegmentStream</a>
                </li>
            
                <li class="drop-menu developer active   current " data-order="5">
                    <a href="/for-developer/helpers">Helper functions</a>
                </li>
            
        
        
    
        
        
        
        
        
        
        
        
            <li class="nav-header ecommerce ">Ecommerce integration</li>
            
                <li class="drop-menu ecommerce " data-order="1">
                    <a href="/ecommerce/main-page">Homepage</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="1">
                    <a href="/ecommerce/index">Overview</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="2">
                    <a href="/ecommerce/listing">Product category</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="3">
                    <a href="/ecommerce/search">Search results</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="4">
                    <a href="/ecommerce/product">Product page</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="5">
                    <a href="/ecommerce/cart">Cart</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="6">
                    <a href="/ecommerce/checkout">Checkout process page</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="7">
                    <a href="/ecommerce/transaction">'Thank You' page</a>
                </li>
            
                <li class="drop-menu ecommerce " data-order="8">
                    <a href="/ecommerce/content">Content page</a>
                </li>
            
        
        
    
        
        
        
        
        
        
        
        
            <li class="nav-header digitaldata ">Variable list</li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/wishlist">wishlist</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/cart">cart</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/changes">changes</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/context">context</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/events">events</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/listing">listing</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/page">page</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/product">product</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/recommendation">recommendation</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/standard-version">version</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/transaction">transaction</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/user">user</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/website">website</a>
                </li>
            
                <li class="drop-menu digitaldata " data-order="1">
                    <a href="/digitaldata/campaigns">campaigns</a>
                </li>
            
        
        
    
        
        
        
        
        
        
        
        
            <li class="nav-header events ">Events list</li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-product">Viewed Product</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/added-payment-info">Added Payment Info</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/added-product-to-wishlist">Added Product to Wishlist</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/added-product">Added Product</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/clicked-campaign">Clicked Campaign</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/clicked-product">Clicked Product</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/completed-checkout-step">Completed Checkout Step</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/completed-transaction">Completed Transaction</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/logged-in">Logged In</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/received-voucher">Received Voucher</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/refunded-transaction">Refunded Transaction</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/registered">Registered</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/removed-product-from-wishlist">Removed Product from Wishlist</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/removed-product">Removed Product</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/searched-products">Searched Products</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/started-order">Started Order</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/subscribed">Subscribed</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/unsubscribed">Unsubscribed</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/updated-cart">Updated Cart</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/updated-profile-info">Updated Profile Info</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-campaign">Viewed Campaign</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-cart">Viewed Cart</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-checkout-step">Viewed Checkout Step</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-experiment">Viewed Experiment</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-page">Viewed Page</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-product-detail">Viewed Product Detail</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/viewed-product-listing">Viewed Product Listing</a>
                </li>
            
                <li class="drop-menu events " data-order="2">
                    <a href="/events/achieved-experiment-goal">Achieved Experiment Goal</a>
                </li>
            
        
        
    
        
        
        
        
        
        
        
        
            <li class="nav-header integrations ">Integration list</li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/yandex-metrica">Yandex.Metrica</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/ddmanager-streaming">Streaming</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/facebook">Facebook</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/gdeslon">GdeSlon</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/google-adwords">Google Adwords</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/google-analytics">Google Analytics</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/onesignal">OneSignal</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/rtb-house">RTB House</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/vkontakte">Vkontakte</a>
                </li>
            
                <li class="drop-menu integrations " data-order="1">
                    <a href="/integrations/criteo">Criteo</a>
                </li>
            
        
        
    
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>


                    </div>

                    <div id="content" class="col-sm-9 col-md-7">
                        <div class="page-header">
    <h1>Helper functions
        
    </h1>
</div>

<p>Helper functions help you write code faster and with fewer errors, plus, they make your code more readable.
They can be used in the setup of variables, events, and scripts.</p>

<h3 id="page-contents">Page contents</h3>
<hr />
<ul class="page-navigation">
  <li><a href="#_queryParam">Get URL parameter value</a></li>
  <li><a href="#_cookie">Get cookie value</a></li>
  <li><a href="#_get">Safely get any property of an object</a></li>
  <li><a href="#_digitalData">Safely get any digitalData property</a></li>
  <li><a href="#_loadPixel">Load pixel</a></li>
  <li><a href="#_loadScript">Load script</a></li>
  <li><a href="#_loadIframe">Load Iframe</a></li>
  <li><a href="#_loadLink">Load link</a></li>
  <li><a href="#_global">Safely get any window property</a></li>
  <li><a href="#_domQuery">Get an array of elements by CSS-selector</a></li>
  <li><a href="#_dataLayer">Safely get a GTM dataLayer variable</a></li>
  <li><a href="#_fetch">Get data from a remote server using ajax</a></li>
  <li><a href="#_timeout">Delay before the handler returns the result</a></li>
  <li><a href="#_retry">Try calling a function several times</a></li>
</ul>

<h3 id="get-url-parameter-value---_queryparam"><a name="_queryParam"></a>Get URL parameter value - _queryParam</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_queryParam</span><span class="p">(</span><span class="nx">string</span><span class="p">);</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is the name of the query parameter.</p>

<p>Get the value of the parameter on the page www.test.ru?q=blue%20ball:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_queryParam</span><span class="p">(</span><span class="s1">'q'</span><span class="p">);</span> <span class="c1">// blue%20ball</span>
</code></pre>
</div>
<blockquote>
  <p>The <code class="highlighter-rouge">_queryParam()</code> function always returns values in lowercase</p>
</blockquote>

<h3 id="get-cookie-value---_ga"><a name="_cookie"></a>Get cookie value - _ga</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_cookie</span><span class="p">(</span><span class="nx">string</span><span class="p">);</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is the name of the cookie.</p>

<p>Get the GA cookie value:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_cookie</span><span class="p">(</span><span class="s1">'_ga'</span><span class="p">);</span> <span class="c1">// GA1.2.1409919348.1513159051</span>
</code></pre>
</div>

<h3 id="safely-get-any-property-of-an-object---_get"><a name="_get"></a>Safely get any property of an object - _get</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_get</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">string</span><span class="p">);</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is the path inside the <code class="highlighter-rouge">object</code>.</p>

<p>Get the value of ‘transaction.lineItems’ from a digitalData event object:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_get</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="s1">'transaction.lineItems'</span><span class="p">);</span> <span class="c1">// lineItems array [...]</span>
</code></pre>
</div>

<h3 id="safely-get-any-digitaldata-property---_digitaldata"><a name="_digitalData"></a>Safely get any digitalData property - _digitalData</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_digitalData</span><span class="p">(</span><span class="nx">string</span><span class="p">);</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is the path inside the digitalData object.</p>

<p>Get the value of ‘transaction.lineItems’ from the digitalData object:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_digitalData</span><span class="p">(</span><span class="s1">'transaction.lineItems'</span><span class="p">);</span> <span class="c1">// lineItems array [...]</span>
</code></pre>
</div>

<h3 id="load-pixel---_loadpixel"><a name="_loadPixel"></a>Load pixel - _loadPixel</h3>
<hr />
<p>Any number of attributes is supported.</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadPixel</span><span class="p">({</span>
  <span class="na">src</span><span class="p">:</span> <span class="s1">'link to pixel'</span><span class="p">,</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'id of pixel'</span><span class="p">,</span>
  <span class="c1">//...any other attributes</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Load pixel from https://example.com/pixel.png:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadPixel</span><span class="p">({</span><span class="na">src</span><span class="p">:</span> <span class="s1">'https://example.com/pixel.png'</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="s1">'admit_ad'</span><span class="p">});</span>
</code></pre>
</div>

<h3 id="load-script---_loadscript"><a name="_loadScript"></a>Load script - _loadScript</h3>
<hr />
<p>Any number of attributes is supported.</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadScript</span><span class="p">({</span>
  <span class="na">src</span><span class="p">:</span> <span class="s1">'link to script'</span><span class="p">,</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'id of script'</span><span class="p">,</span>
  <span class="c1">//...any other attributes</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Load script from https://example.com/script.js:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadScript</span><span class="p">({</span><span class="na">src</span><span class="p">:</span> <span class="s1">'https://example.com/script.js'</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="s1">'google'</span><span class="p">});</span>
</code></pre>
</div>

<h3 id="load-iframe---_loadiframe"><a name="_loadIframe"></a>Load iframe - _loadIframe</h3>
<hr />
<p>Any number of attributes is supported.</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadIframe</span><span class="p">({</span>
  <span class="na">src</span><span class="p">:</span> <span class="s1">'link to iframe'</span><span class="p">,</span>
  <span class="na">id</span><span class="p">:</span> <span class="s1">'id of iframe'</span><span class="p">,</span>
  <span class="na">style</span><span class="p">:</span> <span class="s1">'display: none;'</span><span class="p">,</span>
  <span class="c1">//...any other attributes</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Load iframe from https://example.com/window:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadIframe</span><span class="p">({</span><span class="na">src</span><span class="p">:</span> <span class="s1">'https://example.com/window'</span><span class="p">,</span> <span class="na">style</span><span class="p">:</span> <span class="s1">'display: none;'</span><span class="p">});</span>
</code></pre>
</div>

<h3 id="load-link---_loadlink"><a name="_loadLink"></a>Load link - _loadLink</h3>
<hr />
<p>Any number of attributes is supported.</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadLink</span><span class="p">({</span>
  <span class="na">src</span><span class="p">:</span> <span class="s1">'link path'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'link type'</span><span class="p">,</span>
  <span class="c1">//...any other attributes</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Load link from https://example.com/style.css:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadLink</span><span class="p">({</span><span class="na">href</span><span class="p">:</span> <span class="s1">'https://example.com/style.css'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s2">"text/css"</span><span class="p">});</span>
</code></pre>
</div>

<h3 id="safely-get-any-window-property---_global"><a name="_global"></a>Safely get any window property - _global</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_global</span><span class="p">(</span><span class="nx">string</span><span class="p">);</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is the path inside the window object.</p>

<p>Get the value of window.settings.mobile_app:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_global</span><span class="p">(</span><span class="s1">'settings.mobile_app'</span><span class="p">);</span>
</code></pre>
</div>

<h3 id="get-an-array-of-elements-by-css-selector---_global"><a name="_global"></a>Get an array of elements by CSS-selector - _global</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_domQuery</span><span class="p">(</span><span class="nx">string</span><span class="p">);</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is the CSS-selector.</p>

<p>Get an array of elements which have the ‘logo’ id:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_domQuery</span><span class="p">(</span><span class="s1">'#logo'</span><span class="p">);</span>
</code></pre>
</div>
<blockquote>
  <p>The <code class="highlighter-rouge">_domQuery()</code> function, and the selectors in the triggers <strong>Click</strong> and <strong>Impression</strong> work by the following principle:</p>
  <ul>
    <li>if jQuery is not loaded on the website (there is no global window.jQuery object) or jQuery is loaded after SegmentStream (is located further down the HTML page), <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll">document.querySelectorAll</a> is used,</li>
    <li>if jQuery is loaded on the website, jQuery selectors are used.</li>
  </ul>
</blockquote>

<h3 id="safely-get-a-gtm-datalayer-variable---_datalayer"><a name="_dataLayer"></a>Safely get a GTM dataLayer variable - _dataLayer</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_dataLayer</span><span class="p">(</span><span class="nx">string</span><span class="p">);</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is a path inside a _dataLayer event object.</p>

<p>Get the value of ‘ecommerce.purchase’ from the dataLayer:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_dataLayer</span><span class="p">(</span><span class="s1">'ecommerce.purchase'</span><span class="p">);</span>
</code></pre>
</div>

<h3 id="get-data-from-a-remote-server-using-ajax---_fetch"><a name="_fetch"></a>Get data from a remote server using ajax - _fetch</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="k">return</span> <span class="nx">_fetch</span><span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">});</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">string</code> is the route to the server, and <code class="highlighter-rouge">result</code> is the data from the server response.</p>

<p>Get data about the cart contents from the ‘/ajax?cart’ link:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="k">return</span> <span class="nx">_fetch</span><span class="p">(</span><span class="s1">'/ajax?cart'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">});</span>
</code></pre>
</div>

<h3 id="delay-before-the-handler-returns-the-result---_timeout"><a name="_timeout"></a>Delay before the handler returns the result - _timeout</h3>
<hr />
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="k">return</span> <span class="nx">_timeout</span><span class="p">(</span><span class="nx">number</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">code</span>
<span class="p">});</span>
</code></pre>
</div>
<p>Where <code class="highlighter-rouge">number</code> is the length of the delay in milliseconds, and <code class="highlighter-rouge">code</code> is the code that should be executed after the delay.</p>

<p>Send an event with a delay of 1500 milliseconds:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="k">return</span> <span class="nx">_timeout</span><span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'Event With Timeout'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<h3 id="try-calling-a-function-several-times---_retry"><a name="_retry"></a>Try calling a function several times - _retry</h3>
<hr />
<p>The function takes 3 arguments, the function to be called, the number of attempts, the interval between the attempts.
Call function X every Y milliseconds, if the function returns an error, try again Z times:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_retry</span><span class="p">(</span><span class="nx">X</span><span class="p">,</span> <span class="nx">Z</span><span class="p">,</span> <span class="nx">Y</span><span class="p">);</span>
</code></pre>
</div>
<blockquote>
  <p>The arguments Z and Y are optional, the default interval is 1000 milliseconds, the default number of attempts is 5.</p>
</blockquote>

<p>Possible use case:
An external library is loaded asynchronously, we don’t know how long it will take to load, so in order to avoid any errors, we will use the following code.</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">_loadScript</span><span class="p">({</span><span class="na">src</span><span class="p">:</span> <span class="s1">'https://example.com/externalLib.js'</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="s1">'someName'</span><span class="p">});</span>
<span class="nx">_retry</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">externalLib</span><span class="p">.</span><span class="nx">method</span><span class="p">();</span>
<span class="p">},</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2000</span><span class="p">);</span>
</code></pre>
</div>
<p>The code above will load the library using the _loadScript helper, and the _retry helper will call the window.externalLib.method() function every 2000 milliseconds, if the function returns an error, it will try 10 times in total.</p>


                    </div>
                
            </div>
            <button id="myBtn" title="Go to top"></button>
        </div>
        <div id="footer">
            <div class="questionaire">
    <div class="row step1">
        <div class="col-sm-6 question">
            
            Was this page helpful?
            
        </div>
        <div class="col-sm-6 answer">
            <div class="button-questionaire">
                YES
            </div>
            <div class="button-questionaire">
                NO
            </div>
        </div>
    </div>
    <div class="row step2">
        <div class="col-xs-12">
            
            Thanks for the feedback!
            
        </div>
    </div>
</div>
<a href="/"><img src="/img/segmentstream-logo.png" height="47" alt=SegmentStream documentation class="ddm-logo-footer"></a>
<p class="copyright">Copyright © 2019 "SegmentStream" All rights reserved.</p>

        </div>
        <!-- SegmentStream snippet -->
        <script type="text/javascript">
        (function(h,d){d=d||"cdn.segmentstream.com";var a=window.ddManager=window.ddManager||[];window.ddListener=window.ddListener||[];var b=window.digitalData=window.digitalData||{};b.events=b.events||[];b.changes=b.changes||[];if(!a.initialize)if(a.invoked)window.console&&console.error&&console.error("SegmentStream snippet included twice.");else{a.invoked=!0;a.methods="initialize addIntegration persist unpersist on once off setConsent".split(" ");a.factory=function(k){return function(){var c=Array.prototype.slice.call(arguments);
        c.unshift(k);a.push(c);return a}};for(b=0;b<a.methods.length;b++){var f=a.methods[b];a[f]=a.factory(f)}a.load=function(a){var c=document.createElement("script");c.type="text/javascript";c.charset="utf-8";c.async=!0;c.src=a;a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(c,a)};a.loadProject=function(b){var c=window.location.search;if(0<=c.indexOf("ddm_test_mode=1"))try{var e=!0;window.localStorage.setItem("_ddm_test_mode","1")}catch(g){}else if(0<=c.indexOf("ddm_test_mode=0"))try{e=
        !1,window.localStorage.removeItem("_ddm_test_mode")}catch(g){}else try{e="1"===window.localStorage.getItem("_ddm_test_mode")}catch(g){}e?a.load(window.DDMANAGER_TESTMODE_INIT_URL||"https://api.segmentstream.com/v1/ddm-initialization/"+b+".js"):a.load(window.DDMANAGER_INIT_URL||"https://"+d+"/project/"+b+".js")};a.CDN_DOMAIN=d;a.SNIPPET_VERSION="1.0.11";a.loadProject(h)}})("975f9b27-a262-4758-9019-0bf81f566d68");
        </script>
        <!-- //SegmentStream snippet -->
    </body>
</html>
