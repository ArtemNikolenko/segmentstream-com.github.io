---
layout: page
section: integrationsRU
title: "Google Analytics"
order: 1
---

В данном разделе вы узнаете:
* Как установить счетчик Google Analytics на ваш сайт.
* Как настроить отслеживание событий Google Analytics
* Как настроить модуль расширенной электронной торговли.
* Как настроить события Google Analytics
* Как передать кастомные параметры, метрики и группы контента
* Как тонко настроить отслеживание Google Analytics на вашем сайте

SegmentStream позволяет с легкостью отправлять данные о поведении ваших пользователей в [Google Analytics](https://analytics.google.com/). После полной [интеграции digitalData с вашим сайтом](/ru/for-developer/), можно перейти к настройке интеграции в панели SegmentStream.

### Навигация по странице
------
<ul class="page-navigation">
  <li><a href="#0">Введение</a></li>
  <li><a href="#1">Идентификатор отслеживания</a></li>
  <li><a href="#1_1">Отслеживание событий</a></li>
  <li><a href="#2">Модуль Enhanced Ecommerce</a></li>
  <li><a href="#4">User Id</a></li>
  <li><a href="#5">Улучшенная атрибуция ссылок</a></li>
  <li><a href="#6">Анонимизация IP</a></li>
  <li><a href="#7">Включить кроссдоменное отслеживание</a></li>
  <li><a href="#8">Валюта</a></li>
  <li><a href="#9">Частота сэмплирования</a></li>
  <li><a href="#10">Домен сайта</a></li>
  <li><a href="#11_1">ClientId</a></li>
  <li><a href="#11">Пользовательские метрики</a></li>
  <li><a href="#12">Пользовательские параметры</a></li>
  <li><a href="#13">Группы контента</a></li>
  <li><a href="#15">Название трекера</a></li>
</ul>

### <a name="0"></a>Введение
------
С помощью SegmentStream можно полностью интегрировать Google Analytics с вашим сайтом: события, расширенная электронная торговля, специальные метрики и параметры, группы контента и много другое. <br />
[Справка Google по Google Analytics](https://support.google.com/analytics#topic=3544906) <br/><br/>
Чтобы настроить интеграцию с Google Analytics:
1. авторизуйтесь на сайте [segmentstream.com](https://admin.segmentstream.com) и перейдите к [панели управления интеграциями](https://admin.segmentstream.com/)
2. Нажмите на блок с логотипом Google Analytics
![](/img/integrations.ga.listing.png)
3. В открывшейся панели - настройте Google Analytics.
![](/img/integrations.ga.settings.png)
<br />
Подробнее о настройках вы можете прочитать ниже.

>Важно! Для работы основного трекера Google Analytics необходимо настроить событие [Viewed Page](/ru/events/viewed-page)

### <a name="1"></a>Идентификатор отслеживания
------
Чтобы настроить отслеживание сайта необходимо создать ресурс в аккаунте Google Analytics. При создании ресурса, Google Analytics сгенерирует уникальный идентификатор отслеживания. Как его найти - смотрите на скриншоте ниже.
![](/img/integrations.ga.id.png)
Скопируйте идентификатор отслеживания и вставьте его в интерфейсе SegmentStream в соответствующее поле.
![](/img/integrations.ga.settings.id.png)

### <a name="1_1"></a>Отслеживание событий
------
SegmentStream по-умолчанию отправляет в Google Analytics все события, добавленные в массив `digitalData.events`.

>Важно! Событие [Viewed Page](/ru/events/viewed-page) автоматически преобразуется к типу взаимодействия pageview и не попадают в отчет Behaviour > events > top events

Все события, передаваемые в Google Analytics, могут иметь несколько характеристик: eventCategory, eventAction, eventLabel, eventValue, nonInteraction.
SegmentStream имеет встроенный мэппер формата digitalData в формат Google Analytics. Ниже приведен пример события клика по кнопке.
```javascript
digitalData.events.push({
  category: 'UX',
  name: 'Clicked Button',
  action: 'Clicked Button',
  label: 'Green',
  value: 10,
  nonInteraction: true
})
```

Данное событие будет автоматически преобразовано к формату Google Analytics:
```javascript
ga('send', {
  hitType: 'event',
  eventCategory: 'UX',
  eventAction: 'Clicked Button',
  eventLabel: 'Green',
  eventLabel: 10,
  nonInteraction: true
});
```

>Важно! По-умолчанию, если вы не передадите поле action, в качестве eventAction будет использовано значение поля name. Таким образом action и name могут принимать различные значения.

>Важно! По-умолчанию, nonInteraction принимает значение false.

[Справка Google по отслеживанию событий](https://developers.google.com/analytics/devguides/collection/analyticsjs/events?hl=ru)


### <a name="2"></a>Модуль Enhanced Ecommerce
------
Google Analytics позволяет отслеживать взаимодействие пользователей с вашими товарами: просмотры товаров в каталогах, клики на товары, детальный просмотр карточек товаров, добавления в корзину, покупки и другое. Интеграция с DDM позволяет подключить или отключить модуль расширенной электронной торговли в 1 клик.

[Справка Google по Enhanced Ecommerce](https://support.google.com/analytics/answer/6166254?hl=ru)

>Важно! Чтобы модуль Enhanced Ecommerce корректно работал - необходимо настроить передачу определенных событий в массив `digitalData.events`. Список событий приведен ниже:

**Поддерживаемые события**
* [Viewed Product](/ru/events/viewed-product)
* [Clicked Product](/ru/events/clicked-product)
* [Viewed Campaign](/ru/events/viewed-campaign)
* [Clicked Campaign](/ru/events/clicked-campaign)
* [Viewed Product Detail](/ru/events/viewed-product-detail)
* [Added Product](/ru/events/added-product)
* [Removed Product](/ru/events/removed-product)
* [Viewed Checkout Step](/ru/events/viewed-checkout-step)
* [Completed Checkout Step](/ru/events/completed-checkout-step)
* [Completed Transaction](/ru/events/completed-transaction)
* [Refunded Transaction](/ru/events/refunded-transaction)

>SegmentStream отправляет данные о взаимодействии с товарами совместно с хитом типа `pageview`, если событие пришло синхронно с событием Viewed Page. **Например**: после загрузки страницы "Спасибо за покупку" в Google Analytics уйдет только 1 хит типа `pageview`. Этот хит будет содержать информацию, как о странице, так и о покупке.
>Если событие взаимодействия с товарами наступило после отправки хита типа `pageview`, в Google Analytics будет отправлен дополнительный хит типа `event`. **Например**: на крточке товара доступна возможность оформить заказ в 1 клик без перезагрузки страницы. В этом случае после загрузки страницы будет отправлен 1-й хит типа `pageview` с информацией о товаре и страницы. После нажатия кнопки "подтверждения заказа в 1 клик" и добавления события "Completed Transaction" в массив `digitalData.events`, DigitalDatManager отправит 2-й хит типа `event` с информацией о заказе.

### <a name="4"></a>User Id
------
Если SegmentStream правильно интегрирован в ваш сайт, то значит на каждой странице у вас передан идентификатор посетителя из вашей CRM или ERP в переменную digitalData.user.id. Google Analytics позволяет склеивать сеансы вашего пользователя, произведенные с разных браузеров или устройств, в одну историю благодаря модулю "USER-ID". Включить или отключить отправку USER-ID в Google Analytics можно в 1 клик.

[Справка Google по USER-ID](https://support.google.com/analytics/answer/3123662?hl=ru)
### <a name="5"></a>Улучшенная атрибуция ссылок
------
Модуль улучшенной атрибуции ссылок позволяет автоматически различать ссылки на странице, ведущие на один и тот же URL. Это может понадобиться в случае если вы используете Расширение Page Analytics для Chrome. Данное расширение добавляет слой аналитических данных поверх страницы. Расширение подсвечивает каждую ссылку и выводит набор KPIs. В случае, если бы улучшенная атрибуция ссылок не была включена, KPIs для 2-х ссылок ведущих на один и тот же URL имели ли бы идентичные значения.

[Справка Google по Расширению Page Analytics для Chrome](https://support.google.com/analytics/answer/3123662?hl=ru)
### <a name="6"></a>Анонимизация IP
------
Google Analytics позволяет владельцам сайтов скрывать IP-адреса своих посетителей при обработки данных. Включить или отключить функцию анонимизации IP можно в 1 клик.

[Справка Google по Анонимизации IP](https://support.google.com/analytics/answer/2763052?hl=ru)

### <a name="7"></a>Включить кроссдоменное отслеживание
------
По умолчанию Google Analytics не склеивает в одну историю посещения пользователем разных доменов 2-го уровня. Это бывает нужно, если разные части одного и того же сайта находятся на разных доменах, например: интернет-магазин - https://shop.com и блог - https://blog.com. Для отправки информации о поведении конкретного посетителя на разных доменах в один ресурс Google Analytics необходимо включить функцию кроссдоменного отслеживания.
Активируйте функцию "Включить кроссдоменное отслеживание" и добавьте все домены, которые необходимо связать.

[Справка Google по кроссдоменному отслеживанию](https://support.google.com/analytics/answer/1034342?hl=ru)

### <a name="8"></a>Валюта
------
В Google Analytics есть набор параметров модуля расширенной электронной торговли, которые представляют собой денежные значения в различной валюте, например: доход от товаров, доход от транзакции, стоимость доставки и т.д. Список поддерживаемых валют описан в справке Google. Важно! Если указанная в настройках интеграции SegmentStream валюта отличается от глобальной валюты представления (указанной в настройках Google Analytics), Google Analytics произведет конвертацию по курсу обмена за предыдущий день.

[Справка Google по Валюте](https://support.google.com/analytics/answer/6205902?hl=ru)


### <a name="9"></a>Частота сэмплирования данных о скорости загрузки сайта
------
Google позволяет указать процент пользователей, данные которых будут собираться для отслеживания скорости загрузки сайтов. Значение по умолчанию: 1.

[Справка Google по Сэмплированию данных о скорости загрузки сайта](https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#siteSpeedSampleRate)

### <a name="10"></a>Домен сайта
------
В данной настройке вы можете задать домен, в который будет сохраняться файл cookie с уникальным идентификатором посетителя вашего сайта. Мы рекомендуем использовать значение по умолчанию: `auto`. В этом случае, библиотека Google Analytics автоматически сохраняет все cookie на домен самого высокого уровня.

[Справка Google по Кросс-доменному отслеживанию](https://developers.google.com/analytics/devguides/collection/analyticsjs/cookies-user-id)

### <a name="11_1"></a>ClientId
------
Google Analytics определяет разные хиты от одного и того же посетителя сайта с помощью ClientId.
Идентификатор формируется библиотекой analytics.js и сохраняется в cookies браузера посетителя.
Через SegmentStream отправку ClientId с первым и всеми последующими хитами посетителя можно настроить в 1 клик.
Выберите номер пользовательского параметра в выпадающем списке под полем "Пользовательский параметр, в который передается clientId"

### <a name="11"></a>Пользовательские метрики
------
В Google Analytics есть возможность передавать специальные показатели (метрики). Показатель - это количественное значение (Целое число, дробное число, время). Например: количество сеансов, сумма заказа, глубина просмотра и т.д. Метрики можно передавать на разном уровне:
 - на уровне хита (любое взаимодействие пользователя с сайтом, информация о котором уходит на сервера Google Analytics)
 - на уровне продукта (все взаимодействия пользователя с товаром).
Для того, чтобы настроить передачу специального показателя:

1. Создайте специальный показатель в интерфейсе Google Analytics. Запомните номер созданного показателя
 ![](/img/integrations.ga.metric.2.png)
2. Перейдите к панели настройки интеграции SegmentStream, поле "Пользовательские метрики".
 ![](/img/integrations.ga.metric.1.png)
3. В выпадающем списке выберите номер метрики, который вы только что создали в Google Analytics (например metric1).
 ![](/img/integrations.ga.metric.3.png)
4. Укажите источник данных:
 - **DigitalData**. Любая числовая переменная, которая содержится в объекте digitalData, может быть передана в Google Analytics на уровнях хита. Например: вместе с загрузкой страницы можно передать в Google Analytics на уровне хита количество товаров, которое прямо сейчас у пользователя лежит в корзине.
 - **Event**. В Google Analytics вместе с событием можно передать дополнительную информацию, например: если вам не хватает полей Event Category, Event Action, Event Label, Value.
 - **Product**. Google Analytics позволяет принимать специальные показатели на уровне продукта. Таким образом, вместе со всеми событиями, которые происходят с товарами на вашем сайте (например: просмотр карточки товара, добавления товара в корзину, покупка товара) вы можете передавать дополнительные показатели. Например, можно передать количество товарных единиц, доступное на складе в момент просмотра пользователем карточки товаров.
  >**Важно!** При выборе источника "DigitalData" значение пользовательской метрики или параметра будет передаваться со всеми хитами типа `viewpage` и `event`, происходящими после загрузки страницы. При выборе источника "Event" значение пользовательской метрики или параметра будет передано только с конкретным хитом типа `event`.

5. Сохраните и опубликуйте изменения.

[Справка Google по Специальным показателям](https://support.google.com/analytics/answer/2709829?hl=ru#set_up_custom_metrics)

### <a name="12"></a>Пользовательские параметры
------
В Google Analytics есть возможность передавать специальные Параметры (dimensions). Параметры - это атрибуты данных. Все метрики (числовые данные) рассчитываются в срезах параметров. Примеры параметров: Источник трафика, URL страницы, Регион и т.д. Параметры можно передавать на разном уровне:
  - на уровне хита (информация не агрегируется)
  - на уровне сеанса (информация агрегируется в срезе каждого сеанса каждого пользователя)
  - на уровне пользователя (информация агрегируется в срезе всех сеансов каждого пользователя)
  - на уровне продукта (информация агрегируется в срезе продуктов).

  > Короткое пояснение, для понимания разницы уровней: Например вы хотите передать в GA хобби вашего пользователя в тот момент когда пользователь сохраняет информацию о себе на вашем сайте. Вы отправляете событие и вместе с событием передает специальный параметр (название хобби вашего пользователя). Если вы настроили параметр на уровне хита, то информация о хобби пользователя будет доступна только в отчетах по событиям. Если вы настроили параметр на уровне сеанса, то информация о хобби будет доступна в большинстве отчетов, но только в рамках одного дня и одного сеанса. Если вы настроили параметр на уровне пользователя, то информация о хобби будет доступна в большинстве отчетов и за любой диапазон дат после события.<br />

  Настройка специальных параметров идентична [настройке специальных показателей](#11).

[Справка Google по Специальным параметрам](https://support.google.com/analytics/answer/2709829?hl=ru#set_up_custom_dimensions)

### <a name="13"></a>Группы контента
------
В Google Analytics существует возможность просматривать отчеты не только в срезах определенных адресов страниц, но и групп страниц. Эти группы вы можете задавать сами. Например, вы можете создать группу контента "Тип страницы" и при каждой загрузке станицы передавать туда значение переменной `digitalData.page.type`.
1. Создайте группу контента:
![](/img/integrations.ga.content-grouping.png)
2. Настройте передачу `digitalData.page.type` в интерфейсе DDM:
![](/img/integrations.ga.content-grouping.1.png)

[Справка Google по Группам контента](https://support.google.com/analytics/answer/2853546?hl=ru)

<!--
### <a name="14"></a>Специальные поля
------
Библиотека analytics.js при загрузке каждой страницы создает трекер отслеживания, который отправляет на сервера Google Analytics информацию о действиях пользователя. Информация передается в виде имя-значение. В справке GA [задокументировано много имен/полей](https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference), которые умеет распознавать и записывать в БД система, однако можно создать свое поле и записать туда определенное значение. Это поле будет проигнорировано сервером Google Analytics, но запрос с этим полем будет сформирован библиотекой analytics.js
> Этот нестандартный прием в редких случаях нужен [интеграции с OWOX](/ru/integrations/owox) для того, чтобы например, личные данные пользователя не попали в GA, но при этом записались в bigQuery.

Настройка специальных полей идентична [настройке специальных показателей](#11).
-->

### <a name="15"></a>Название трекера
------
Библиотека analytics.js позволяет создавать не один, а несколько счетчиков на одной и той же странице. Это может понадобиться если вы отправляете данные в два и более ресурсов. Например, если у вас международный бизнес и вы собираете данные из всех регионов в 1 общий ресурс, но каждый регион имеет свой собственный ресурс со своими особенными настройками.
Мы рекомендуем задавать уникальное значение, например `ddm`.

[Справка Google по Названию трекера](https://developers.google.com/analytics/devguides/collection/analyticsjs/creating-trackers?hl=ru#working_with_multiple_trackers)
