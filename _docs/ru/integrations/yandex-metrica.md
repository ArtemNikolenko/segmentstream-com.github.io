---
layout: page
section: integrationsRU
title: "Yandex Metrica"
order: 1
---

В данном разделе вы узнаете:
* Как установить счетчик Яндекс Метрики на сайт.
* Как настроить цели и события в Яндекс Метрике.
* Как передать параметры визитов и пользователей в Яндекс Метрику.
* Как подключить карту кликов и Вебвизор.
* Как подключить модуль электронной торговли в Яндекс Метрике.

Yandex Metrica - система анализа поведения пользователей на сайте. Интеграция с Яндекс Метрикой позволяет передавать сегменты в Яндекс Директ для продвинутого таргетирования ваших рекламных.

### Навигация по странице
------
<ul class="page-navigation">
  <li><a href="#0">Введение</a></li>
  <li><a href="#1">Counter ID</a></li>
  <li><a href="#2">Признак сбора данных карты кликов</a></li>
  <li><a href="#3">Признак использования Вебвизора</a></li>
  <li><a href="#4">Признак отслеживания переходов по внешним ссылкам</a></li>
  <li><a href="#5">Отправлять User ID в Метрику</a></li>
  <li><a href="#6">Числовой идентификатор цели покупки</a></li>
  <li><a href="#7">Настройка целей</a></li>
  <li><a href="#8">Параметры визитов</a></li>
  <li><a href="#9">Параметры посетителей</a></li>
</ul>

### <a name="0"></a>Введение
------
С помощью SegmentStream можно полностью интегрировать Яндекс Метрику с вашим сайтом: цели, вебвизор, карта кликов, электронная торговля, и другое.<br />
[Справка Yandex по интеграции с Yandex Metrica](https://yandex.ru/support/metrika/index.html)

Чтобы настроить интеграцию с Yandex Metrica:
1. авторизуйтесь на сайте [segmentstream.com](https://admin.segmentstream.com/) и перейдите к панели управления интеграциями
2. Войдите на вкладку "Интеграции" и кликните по блоку с логотипом Yandex Metrica.
3. В открывшейся панели - настройте интеграцию.
![](/img/integrations.ym.settings.png)
<br />
Подробнее о настройках вы можете прочитать ниже.

### <a name="1"></a>Counter ID
------
Чтобы настроить отслеживание сайта необходимо создать счетчик в аккаунте Yandex Metrica. При создании счетчика, YAndex Metrica сгенерирует уникальный идентификатор отслеживания. Как его найти - смотрите на скриншоте ниже.

![](/img/integrations.ym.counterid.png)

[Справка Yandex по созданию счетчика](https://yandex.ru/support/metrika/general/creating-counter.html)

### <a name="2"></a>Признак сбора данных карты кликов
------
Яндекс Метрика позволяет собирать информацию обо всех кликах (не только по ссылкам), которые посетители совершают на сайте. В интерфейсе метрики есть специальный отчет, который поможет понять как ваши пользователи взаимодействуют с сайтом.
Включить или отключить Карту кликов можно в 1 клик.

[Справка Yandex по картам кликов](https://yandex.ru/support/metrika/behavior/click-map.html)

### <a name="3"></a>Признак использования Вебвизора
------
Вебвизор позволяет не только передавать информацию о кликах, но и о движении курсора пользователя. В результате, Яндекс Метрика предоставляет возможность просматривать видео взаимодействия пользователей с сайтом. Включить или отключить Вебвизор можно в 1 клик.

[Справка Yandex по Вебвизору](https://yandex.ru/support/metrika/webvisor/about-webvisor.html)

### <a name="4"></a>Признак отслеживания переходов по внешним ссылкам
------
Яндекс метрика позволяет анализировать переходы на внешние ресурсы со страниц вашего сайта. В интерфейсе Яндекс Метрики отчет находится по адресу: "содержание" > "внешние переходы". Включить или отключить Отслеживание по внешним переходам можно в 1 клик.

[Справка Yandex по Внешним переходам](https://yandex.ru/support/metrika/content/external-links.html)

### <a name="5"></a>Отправлять User ID в Метрику
------
Yandex Metrica дает возможность связывать посещения вашего сайта одним и тем же пользователем с разных устройств - в одну историю. Для этого необходимо настроить передачу вашего внутреннего идентификатора клиентов в переменную `digitalData.user.userId`. Включить или отключить Передачу UserId можно кликнув на тумблер.

[Справка Yandex по собственным идентификаторам клиентов](https://yandex.ru/support/metrika/content/external-links.html)

### <a name="6"></a>Числовой идентификатор цели покупки
По умолчание в интеграции с Яндекс Метрика включен модуль электронной торговли. Для его корректной работы должны быть настроены определенные события (список ниже), а также указан числовой идентификатор цели покупки.

Идентификатор цели покупки генерируется Яндекс Метрикой при создании цели ("Настройки" > "Цели").
1. Нажмите кнопку "Добавить цель"
2. Укажите название, например: 'Transaction' или 'Заказ'
3. Если вы используете ретаргетинговые кампании в Яндекс Директ, установите галку "Ретаргетинг"
4. Тип условия: JavaScript-событие
5. Идентификатор цели: 'transaction' или любой другой
![](/img/integrations.ym.goal.1.png)
6. Нажмите ОК и затем сохраните изменения раздела 'Цели'
7. После сохранения скопируйте числовой идентификатор сохраненной цели и вставьте его в поле соответствующей настройки
![](/img/integrations.ym.goal.2.png)

**Обязательные события**
* [Viewed Page](/events/viewed-page)
* [Viewed Product Detail](/events/viewed-product-detail)
* [Added Product](/events/added-product)
* [Removed Product](/events/removed-product)
* [Completed Transaction](/events/completed-transaction)

[Справка Yandex по настройки электронной торговли](https://yandex.ru/support/metrika/reports/ecommerce.html)

### <a name="7"></a>Настройка целей
Все события, которые добавляются в массив `digitalData.events` могут быть переданы в качестве целей в Яндекс Метрику. Для этого необходимо:
1. Создать новую цель в интерфейсе Yandex Metrica. Обязательно указать тип условия: JavaScript-событие. Задать Идентификатор цели
2. В интерфейсе SegmentStream в левом поле указать название События в `digitalData.events`, а в правом - Идентификатор цели в Яндекс Метрике.

![](/img/integrations.ym.goals.png)

[Справка Yandex по целям](https://yandex.ru/support/metrika/general/goals.html)

### <a name="8"></a>Параметры визитов
Если вы хотите строить отчеты в Яндекс Метрике по тем параметрам, которых нет в стандартных отчетах, вам необходимо настроить передачу специальных параметров. Например: мобильная или десктопная версия сайта.

> Важно отличать параметры визитов от параметров посетителей. Параметры визитов распространяются только на сессию, в течение которой они были переданы. Если вы вчера передавали параметр визита вместе со всеми хитами пользователя, а сегодня не передаете, то в отчетах за сегодня этого параметра уже не будет. Если же вы передавали параметр посетителя, то этот параметр будет закреплен за пользователем(браузером пользователя) за все время (в прошлом и будущем), до тех пор пока значение параметра посетителя не будет перезаписано новым значением.

Для того, чтобы настроить передачу параметра визита:

1. Придумайте имя параметра, по которому вы хотите строить отчеты в интерфейсе Яндекс Метрики
2. Запишите это имя в левом поле настроек параметров визитов
3. Укажите источник данных:
 - **DigitalData**. Любая переменная, которая содержится в объекте digitalData, может быть передана в Яндекс Метрику в качестве параметра визита
 - **Event**. Любая переменная любого события, добавленного в массив `digitalData.events` может быть передана в Яндекс Метрику в качестве параметра визита, в момент срабатывания этого события
 4. Укажите в правом поле название переменной

![](/img/integrations.ym.session-params.png)

[Справка Yandex по параметрам визитов](https://yandex.ru/support/metrika/data/visit-params.html)

### <a name="9"></a>Параметры посетителей
Если вы хотите передать в Яндекс Метрику сегмент пользователя, например RFM-сегмент или признак того, что пользователь подписан на рассылку или признак того, что у пользователя брошена корзина - вы можете настроить передачу параметров посетителей.
Процесс настройки подробно описан в [параметрах визитов](#8)

[Справка Yandex по параметрам посетителей](https://yandex.ru/support/metrika/data/user-params.html)

