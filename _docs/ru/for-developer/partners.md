---
layout: page
section: developerRU
title: "События партнерских систем"
date: 2018-06-09 12:00:00
order: 2
---

В данном разделе вы узнаете:
* Как, подключенная к сайту система, может отправить события в Google Analytics и любую другую систему.

Существует ряд систем, которые динамически изменяют сайт: вставляют блок с рекомендуемыми товарами, вызывают всплывающее окно или мини-сообщение, заменяют один баннер на другой и т.д.
Для того, чтобы корректно отслеживать взаимодействие посетителей сайта с блоками контента, "внедренными извне", необходимы действия со стороны подключенных систем.

### Навигация по странице
------
<ul class="page-navigation">
  <li><a href="#0">Введение</a></li>
  <li><a href="#1">Отслеживание произвольного события</a></li>
  <li><a href="#2">Отслеживание события показа товаров в списке</a></li>
  <li><a href="#3">Отслеживание события клика по товару в списке</a></li>
</ul>

### <a name="0"></a> Введение
------
Подключенная система получает доступ к изменению глобального объекта `digitalData` после загрузки своей js-библиотеки. Теперь все события, происходящие с внедренными блоками контента необходимо пушить в массив `digitalData.events`. **SegmentStream** перехватит эти события и отправит в [Google Analytics](/ru/integrations/google-analytics), [Яндекс Метрику](/ru/integrations/yandex-metrica) или другую подключенную систему.

Ниже описаны типовые случаи.

### <a name="1"></a> Отслеживание произвольного события
------
`name`, `source` - обязательные переменные для партнерских событий. Переменные: `category`, `action`, `label`, `value`, `nonInteraction` - являются вспомогательными и нужны для передачи соотвествующих параметров в Google Analytics.

```javascript
digitalData.events.push({
  name: '<Event Name>',
  category: '<Категория события>',
  action: '<Действие по событие>',
  label: '<Ярлык события>',
  value: <Значение события>,         //Число, а не строка
  nonInteraction: true,              //Если не объявить данное поле, по умолчанию будет nonInteraction: false
  source: '<Partner>'                //Имя системы, которая сделала push в массив digitalData.events
});
```

> Используйте правила именования событий в соответствии с [документом](/ru/for-developers/naming)


### <a name="2"></a> Отслеживание события показа товаров в списке
------
>Событие показа товара в списке является семантическим (зарезервированным). Используйте приведенный ниже шаблон для корректной передачи информации в Google Analytics.

```javascript
digitalData.events.push({
  category: 'Ecommerce',
  name: 'Viewed Product',
  listItems: [
    ...,
      {
        position: 4,
        listName: 'Рекомендации на главной',
        product: {
          id: 'AB32',
          skuCode: 'AB3200004',
          name: 'Свитшот',
          category: ['Одежда', 'Платья'],
          unitPrice: 1000,
          unitSalePrice: 800,
          manufacturer: 'gucci',
          variant: 'вариант товара',
          currency: 'RUB'
        }
      },
      {
        position: 5,
        listName: 'Рекомендации на главной',
        product: {
          id: 'XY16',
          name: 'Куртка',
          skuCode: 'XY1600001',
          category: ['Одежда', 'Платья'],
          unitPrice: 2000,
          unitSalePrice: 800,
          manufacturer: 'prada',
          variant: 'вариант товара',
          currency: 'RUB'
        }
      },
      ...
  ],
  source: '<Partner>' // Имя системы, которая сделала push в массив digitalData.events
});
```
где,
* `position` - Позиция товара в списке
* `listName` - Название списка. Эта строка будет отображаться в отчете эффективности список Google Analytics
* `product.id` - Строка, даже если идентификатор числовой. Соответствует groupId в XML-фиде. В случае, если у товаров в фиде нет групп, соответствует offerId.
* `product.skuCode` - Строка, даже если идентификатор числовой. Соответствует offerId в XML-фиде. Не обязательно, если у товаров в фиде нет групп.
* `product.category` - Массив строк от родительской к дочерней слева направо
* `product.unitPrice` - Число, а не строка. Цена до скидки
* `product.unitSalePrice` - Число, а не строка. Цена с учетом скидки. Если скидки нет, то unitSalePrice = unitPrice. Обязательное к заполнению
* `product.variant` - Может быть размер или цвет или другой дополнительный признак

### <a name="3"></a> Отслеживание события клика по товару в списке
------
>Событие клика по товару в списке является семантическим (зарезервированным). Используйте приведенный ниже шаблон для корректной передачи информации в Google Analytics.

```javascript
digitalData.events.push({
  category: 'Ecommerce',
  name: 'Clicked Product',
  listItem:{
    position: 4,
    listName: 'Рекомендации на главной',
    product: {
      id: 'AB32',
      skuCode: 'AB3200004',
      name: 'Свитшот',
      category: ['Одежда', 'Платья'],
      unitPrice: 1000,
      unitSalePrice: 800,
      manufacturer: 'gucci',
      variant: 'вариант товара',
      currency: 'RUB'
    }
  },
  source: '<Partner>' // Имя системы, которая сделала push в массив digitalData.events
});
```
где,
* `position` - Позиция товара в списке
* `listName` - Название списка. Эта строка будет отображаться в отчете эффективности список Google Analytics
* `product.id` - Строка, даже если идентификатор числовой. Соответствует groupId в XML-фиде. В случае, если у товаров в фиде нет групп, соответствует offerId.
* `product.skuCode` - Строка, даже если идентификатор числовой. Соответствует offerId в XML-фиде. Не обязательно, если у товаров в фиде нет групп.
* `product.category` - Массив строк от родительской к дочерней слева направо
* `product.unitPrice` - Число, а не строка. Цена до скидки
* `product.unitSalePrice` - Число, а не строка. Цена с учетом скидки. Если скидки нет, то unitSalePrice = unitPrice. Обязательное к заполнению
* `product.variant` - Может быть размер или цвет или другой дополнительный признак
