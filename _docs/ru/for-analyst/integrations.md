---
layout: page
section: analystRU
title: "Интеграции"
date: 2013-06-05 12:00:00
order: 2
---

Каждая интеграция представляет собой коннектор между `digitalData` и сторонней системой. Интеграция умеет прослушивать все события, добавляемые в массив `digitalData.events`, а также преобразовывать события в необходимый для сторонней системы формат. В случае, если данное событие является необходимым для системы, **SegmentStream** отправляет его.

### Навигация по странице
------
<ul class="page-navigation">
  <li><a href="#0">Введение</a></li>
  <li><a href="#1">Настройка</a></li>
  <li><a href="#2">Переменные событий</a></li>
  <li><a href="#2_1">Таргетирование интеграции</a></li>
  <li><a href="#3">Тестирование</a></li>
  <li><a href="#4">Публикация</a></li>
</ul>

### <a name="0"></a> Введение
------
Для корректной работы интеграций необходимо настроить добавление в массив `digitalData.events` семантических событий: [Viewed Product Detail](/events/viewed-product-detail), [Clicked Product](/events/clicked-product), [Added Product](/events/added-product), [Completed Transaction](/events/completed-transaction) и других. Каждая интеграция использует свой набор событий. Полный список зарезервированных событий описан в документации.

Интерфейс управления интеграциями содержит 2 вкладки:
 - **Настройки**. Каждая интеграция имеет набор настроек. Для одних интеграций - это только уникальный идентификатор в сторонней системе, для других - достаточно длинный список. Описание настроек всех интеграций есть в данной документации на соответствующих страницах.
 - **Переменные событий**. Каждое событие содержит в себе набор переменных. Бывает так, что в зависимости от определенных условий, переменные должны принимать нестандартные значения. Например, вы можете использовать различные товарные фиды с различными идентификаторами товаров для каждого региона России. В этом случае необходимо "на лету" переопределять `product.id`.

Ниже описан типовой процесс подключения любой интеграции.

### <a name="1"></a> Настройка
------
На экране "Интеграции" выберете систему, которую вы хотите подключить и кликните по карточке этой системы.

![](/img/integrations.1.png)

> Зеленый индикатор на карточке системы указывает на ее активное состояние в данный момент.

На открывшейся панели необходимо произвести настройки интеграции. Подробнее о каждой интеграции читайте в соответствующем разделе документации.

### <a name="2"></a> Переменные событий
------
Бывают случаи, когда требуется тонкая настройка некоторых интеграций. Например в одну интеграцию уходят идентификаторы "как есть" из переменной `product.id`, а в другую подключенную систему должны уходить идентификаторы с префиксом региона.

Разберем пример переопределения идентификатора товара в зависимости от региона пользователя в интеграции с Google Adwords.
1. Перейдите на вкладку "Переменные событий" и нажмите кнопку "Добавить"
  ![](/img/integrations.4.png)
2. В открывшемся окне заполните поля: Родительский объект, Имя переменной, Название события, Функция, которая заполняет значение переменной.
3. В поле "Родительский объект" выберете "Продукт".
4. В поле "Имя переменной" укажите переменную события, значение которой необходимо изменить.
5. Поле "Название события" оставьте пустым. В данном случае значение идентификатора товара изменится во всех, событиях, необходимых для данной интеграции. Если же значение нужно перезаписать только для определенного события - укажите его название.
6. Функция, которая заполняет значение переменной обязательно должна возвращать значение (содержать конструкцию return). Именно значение, возвращаемое данной функций будет помещено в переменную, указанную в поле "Имя переменной" при наступлении события "Название события".
  ![](/img/integrations.5.png)

Как видно в примере, переменная `product.id` принимает различное значение в зависимости от региона пользователя. Для пользователей из Москвы к значению поля `digitalData.product.id` добавляется суффикс "-moscow".
Если раньше в Google Adwords ушло бы следующее значение переменной productId: "3856", то после изменения уйдет "3856-moscow".

Здесь,
 - '3856' - это идентификатор товара, который сервер записывает в переменную `digitalData.product.id`
 - '3856-moscow' - это значение идентификатора товара, указанного в XML-фиде, переданном в Google Adwords для региона "Москва".

### <a name="2_1"></a> Таргетирование интеграции
------
Таргетирование интеграции необходимо в тех случаях, когда интеграция должна быть загружена только на определенных страницах или только для определенной группы пользователей. Также бывает необходимо изменить "дефолтное" поведение интеграции, например: Аккаунт Менеджер из Criteo попросил отключить передачу информации о первых 3-х товарах каталога при наступлении события "Viewed Product Listing".

В этих случаях необходимо использовать переменную события ignore, которая принимает 2 значения true и false.

Примеры:
1. Отключить интеграцию Criteo для события Viewed Product Listing
![](/img/integrations.6.png)
2. Отключить интеграцию Criteo для всех пользователей с определенным IP-адресом (например для сотрудников компании)
![](/img/integrations.7.png)

> Если переменная `ignore` не передана в объект события, SegmentStream считает это равноценным `ignore: true`

### <a name="3"></a> Тестирование
------
После настройки интеграции необходимо произвести тестирование. Перейдите на ваш сайт в режиме **test_mode**.

> Чтобы активировать test_mode необходимо загрузить любую страницу вашего сайте с GET-параметром ddm_test_mode=1, например: [http://shop1.driveback.ru/?ddm_test_mode=1](http://shop1.driveback.ru/?ddm_test_mode=1)

Откройте консоль (правая кнопка мыши -> Просмотр кода страницы). В консоли вы увидите последовательность событий отправляемых в подключенные интеграции. Вместе с событиями вы увидите все переменные, которые отправляются в интеграции. Существует 3 индикатора:
1. Если все настроено верно, все переменные будут подсвечены зеленым цветом.
2. Если есть какая-то некритическая ошибка - вы увидите оранжевый цвет
3. В случае критической ошибки, вы увидите красный цвет и символ `x>`, который означает, что событие не было отправлено в интеграцию.

 ![](/img/integrations.2.png)
 ![](/img/integrations.3.png)

В случае наличия ошибки, обратите внимание на строку с указанием ошибки. Чаще всего ошибка будет заключаться в том, что вы не передаете в digitalData при загрузке странице нужную для интеграции переменную.

### <a name="4"></a> Публикация
------
После того, как вы проверите интеграцию в test_mode режиме, можете опубликовать проект. Для этого нажмите кнопку "Опубликовать" в верхней правой части страницы.
