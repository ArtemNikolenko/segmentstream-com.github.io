---
layout: page
section: integrationsRU
title: "OneSignal"
order: 1
---

В данном разделе вы узнаете:
* Как подключить Веб-Пуши от oneSignal на сайте.
* Как настроить передачу сегментов в oneSignal.

OneSignal - система для отправки кросс-браузерных и кросс-платформенных пуш-уведомлений. OneSignal умеет создавать аудитории на основе событий сайта и отправлять браузерные пуши этой аудитории. SegmentStream позволяет передавать данные о поведении ваших пользователей в [oneSignal](https://onesignal.com/).


### Навигация по странице
------
<ul class="page-navigation">
  <li><a href="#0">Введение</a></li>
  <li><a href="#1">OneSignal App ID</a></li>
  <li><a href="#2">Автоматическая регистрация</a></li>
  <li><a href="#3">Событие digitalData, инициирующее подписку на push</a></li>
  <li><a href="#4">Использовать Slide Prompt</a></li>
  <li><a href="#4_1">Настройки Slide Prompt</a></li>
  <li><a href="#5">Настройка тегов</a></li>
  <li><a href="#6">Перехват событий системного попапа</a></li>
</ul>


### <a name="0"></a>Введение
------
С помощью SegmentStream можно полностью интегрировать OneSignal с вашим сайтом.<br />
[Техническая документация OneSignal](https://documentation.onesignal.com/docs/web-push-sdk-setup-https)

>Рекомендуем предварительно полностью перевести ваш сайт на протокол https. В этом случае процесс подписки на пуш-уведомления для ваших пользователей будет проще.

>Перед настройкой интеграции в интерфейсе SegmentStream необходимо установить в корень вашего сайта 3 файла.<br/> Подробнее читайте в [документации от OneSignal](https://documentation.onesignal.com/docs/web-push-sdk-setup-https#section-2-upload-required-files)

Чтобы настроить интеграцию с OneSignal:
1. Авторизуйтесь на сайте [segmentstream.com](https://admin.segmentstream.com/) и перейдите к панели управления интеграциями
2. Войдите на вкладку "Интеграции" и кликните по блоку с логотипом OneSignal.
3. В открывшейся панели - настройте интеграцию.

![](/img/integrations.onesignal.1.png)

Подробнее о настройках вы можете прочитать ниже.


### <a name="1"></a>OneSignal App ID
------
Идентификатор проекта вы можете найти в интерфейсе OneSignal.

![](/img/integrations.onesignal.2.png)

Скопируйте идентификатор и вставьте его в поле "OneSignal App ID" окна настроек интеграции.

### <a name="2"></a>Автоматическая регистрация
------
Если включить данный тумблер, то окно подписки будет появляться сразу после загрузки первой страницы вашего сайта.

>Не рекомендуем использовать данный метод сбора подписок.

### <a name="3"></a>Событие digitalData, инициирующее подписку на push
------
Для того чтобы пользователь смог получать пуш-уведомления, сначала он должен подписаться. Форма для подписки зависит только от версии браузера, вы не можете ее никак изменить. Вы можете только управлять моментом появления формы ы браузере пользователя.

![](/img/integrations.onesignal.4.png)

 SegmentStream позволяет управлять моментом показа окна подписки. Для того чтобы задать этот момент, укажите в соответствующем поле имя события. После того, как данное событие произойдет (будет добавлено в массив `digitalData.events`), отобразится стандартное окно подписки на push-уведомления.

### <a name="4"></a>Использовать Slide Prompt
------
Если включить данный тумблер, то вместо системного окна подписки будет появляться стилизованное окно подписки от OneSignal.

![](/img/integrations.onesignal.5.png)

>Эта опция работает корректно только если в настройках в кабинете OneSignal была выбрана настройка "Custom Code".
>При использовании этой опции без настройки "Custom Code", конфигурации сделаные в кабинете OneSignal будут перезаписаны.

### <a name="4_1"></a>Настройки Slide Prompt
------
При включении тумблера "Использовать Slide Prompt" во всплывающем окне передается стандартный текст OneSignal как показано на скриншоте выше.<br>
Используя настройки Slide Prompt можно кастомизировать этот текст. Настройка текста делится на 3 части:
- Сообщение Slide Prompt (максимальная длинна 90 символов)
- Текст кнопки подтверждения Slide Prompt (максимальная длинна 15 символов)
- Текст кнопки отказа Slide Prompt (максимальная длинна 15 символов)

Незаполненные поля отображаются со стандартным текстом.

Пример настройки и результат:
![](/img/integrations.onesignal.7.png)

### <a name="5"></a>Настройка тегов
------
OneSignal дает широкие возможности для построения триггерных коммуникаций. Например вы можете настроить отправку пуш-уведомлений тем пользователям, которые положили товар в корзину и ушли (брошенная корзина). Для этого система должна знать состав корзины при каждой загрузки страницы.

SegmentStream умеет отправлять вместе с любыми событиями любую информацию из объекта `digitalData`.

Чтобы настроить передачу переменных, заполните 2 поля:
1. Слева - Название переменной, вы хотите видеть в интерфейсе OneSignal
2. В центре - укажите `digitalData`, если переменная присутствует в объекте всегда или `event`, если переменная появляется только в определенных событиях.
2. Справа - путь к переменной в объекте `digitalData` или `event`.

Пример заполнения смотрите на первом скриншоте.

### <a name="6"></a>Перехват событий системного попапа
------
OneSignal дает возможность подписаться на события взаимодействия с системным попапом подписки на push-уведомления. Существует 3 способа взаимодействия:
 - Нажатие на кнопку "Разрешить" - "Allowed Push Notifications"
 - Нажатие на кнопку "Блокировать" - "Blocked Push Notifications"
 - Нажатие на крестик, закрывающий попап - "Closed Push Notifications Prompt"

![](/img/integrations.onesignal.6.png)

После того, как пользователь совершит одно из 3-х возможных действий, в массив `digitalData.events` будет автоматически добавлено соответствующее событие:

1. Нажатие на кнопку "Разрешить"
```javascript
digitalData.events.push({
  category: 'Push Notifications',
  name: 'Allowed Push Notifications'
})
```

2. Нажатие на кнопку "Блокировать"
```javascript
digitalData.events.push({
  category: 'Push Notifications',
  name: 'Blocked Push Notifications'
})
```

3. Нажатие на крестик, закрывающий попап
```javascript
digitalData.events.push({
  category: 'Push Notifications',
  name: 'Closed Push Notifications Prompt'
})
```
